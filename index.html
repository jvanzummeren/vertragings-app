<!DOCTYPE html>
<html>
<head>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  	<meta name="apple-mobile-web-app-capable" content="yes" />  
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" /> 

	<title>Vertragingsapp</title>
	<link href="css/boilerplate.css?v=2" rel="stylesheet" type="text/css" />
	<link href="css/main.css?v=2" rel="stylesheet" type="text/css" />
	<link href="css/guus.css" rel="stylesheet" type="text/css" />
	<link href="css/normalize.css?v=2" rel="stylesheet" type="text/css" />
  	<link href="css/idangerous.swiper.css?v=2" rel="stylesheet" type="text/css" />
  	<link rel="stylesheet" href="http://code.jquery.com/ui/1.10.3/themes/smoothness/jquery-ui.css">
  
</head>
<body>
	<header class="navigation-bar">
		<span class="menu-button add">
			<i class="menusprite menusprite--add"></i>
		</span>
		<h1>Trajecten</h1>	
	</header>

	<!--section class="editsettings">
		<button class="closesettings"></button>
		<img src="img/sprites/instellingenplaceholder.png" alt="" class="closesettings">
	</section-->

	<div class="swiper-container">
		<div class="swiper-wrapper">

			<!-- Trajectpagina -->
			
		</div>
	</div>

	<div class="pagination"></div>

	<!--
	<i class="iconsprite-pt iconsprite--bus"></i>
	<i class="iconsprite-pt iconsprite--bus late"></i>
	<i class="iconsprite-pt iconsprite--subway"></i>
	<i class="iconsprite-pt iconsprite--subway late"></i>
	<i class="iconsprite-pt iconsprite--train"></i>
	<i class="iconsprite-pt iconsprite--train late"></i>
	-->
	<!-- TOEVOEGEN-->

 <section class="toevoegen">
                  <header class="navigation-bar-toevoegen">
                        <span class="button-back">
                            <i class="icon-back">Terug</i>
                        </span>
                        <span class="button-cancel">
                            <i class="icon-cancel">Annuleer</i>
                        </span>
                        <span class="button-finish">
                            <i class="icon-finish">Voeg toe</i>
                        </span>
                        <span class="button-choose">
                            <i class="icon-choose">Kies</i>
                        </span>
                        <span class="button-edit">
                            <i class="icon-edit2">Pas aan</i>
                        </span>
                  </header>

                  <section class="first-step">
                    <div class="overlay"></div> 
                    <section class="traject-toevoegen">
                      <h1 class="titel-toevoegen">WELK TRAJECT WIL JE TOEVOEGEN?</h1>
                      <h1 class="titel-edit">WAT WIL JE AANPASSEN AAN HET TRAJECT?</h1>
                      <div class="plaatsnaam plaatsnaam-van">
                                <label for="tags">Van </label>
                                <input class="plaatsnaam-input">
                                <a href="#">Oke</a>
                      </div>
                      <div class="plaatsnaam-line"></div>
                      <div class="plaatsnaam plaatsnaam-naar">
                        <label for="tags">Naar </label>
                        <input class="plaatsnaam-input">
                        <a href="#">Oke</a>
                      </div>
                    </section>

                    <section class="traject-toevoegen-vervoersmiddelen">
                      <ul>
                        <li><input type="checkbox" class="image-bus" value="bus" id="CB1" checked/><label for='CB1'></label></li>
                        <li><input type="checkbox" class="image-trein" value="trein" id="CB2" /><label for='CB2'></label></li>
                        <li><input type="checkbox" class="image-tram" value="tram" id="CB3" checked/><label for='CB3'></label></li>
                        <li><input type="checkbox" class="image-metro" value="metro" id="CB4" checked/><label for='CB4'></label></li>
                      </ul>
                    </section>

                    <section class="traject-toevoegen-title">
                      <label for="tags">Naam </label>
                      <input class="naam-input" maxlength="15">
                    </section>

                    <section class="traject-toevoegen-customimage">
                        <section class="block1">
                        	<div class="afbeelding-toevoegen">
                          		<span>Afbeelding toevoegen</span><i class="icon-arrow"></i>
                          	</div>
                    	</section>
                	</section>

                  </section>

                  <section class="second-step">
                    <section class="traject-toevoegen">
                      <h1>KIES EEN FOTO</h1>	
                     
                      <section class="traject-toevoegen-customimage">
                        <section class="custom-images">
                            <ul>
                              <li class="selected"><img src="" alt="" class="thumbs"></li>
                              <li><img src="" alt="" class="thumbs"></li>
                              <li><img src="" alt="" class="thumbs"></li>
                              <li><img src="" alt="" class="thumbs"></li>
                              <li><img src="" alt="" class="thumbs"></li>
                              <li><img src="" alt="" class="thumbs"></li>
                              <li><img src="" alt="" class="thumbs"></li>
                              <li><img src="" alt="" class="thumbs"></li>
                            </ul>
                            <input type="hidden" class="selected-image" value="0"/>
                        </section>
                        <section class="block2">
                          	<span>Of kies uit filmrol<i class="icon-arrow"></i></span>
                        </section>
                      </section>

                    </section>

                    <!--section class="traject-toevoegen-finish">
                      <button class="traject-toevoegen-button">VOEG TRAJECT TOE</button>
                    </section>
                    <section class="traject-toevoegen-edit">
                      <button class="traject-toevoegen-button">AANPASSEN</button>
                    </section-->


                  </section>
        </section>
	<script type="text/template" id="traject-slide-template">
		<div class="swiper-slide">

			<div class="traject-container">
				<header class="traject-description" style="background-image: url(img/trajectbg0.png)">
					<i class="icon-switch"></i>
					<div>
						<h1 class="traject-name">Werk</h1>
						<h2 class="from">Station Koog aan de Zaan</h2>
						<h2 class="to">Metro Weesperplein</h2>
					</div>
					<i class="icon-edit"></i>
				</header>
				<ul>
					<li class="traject">
						<div class="traject-short">
							<div class="traject-short-time">
								<span class="time-start">12:00</span>
								<i class="iconsprite iconsprite--arrow"></i>
								<span class="time-end">12:50</span>
							</div>
							<div class="traject-short-icons">
								<i class="iconsprite-pt-short iconsprite--short-bus"></i>
								<i class="iconsprite-pt-short iconsprite--short-tram"></i>
								<i class="iconsprite-pt-short iconsprite--short-subway"></i>
								<i class="iconsprite-pt-short iconsprite--short-train"></i>
							</div>
							<i class="iconsprite iconsprite--collapse"></i>
							<span class="delay-time"></span>
						</div>
						<div class="transport" icon="iconsprite--short-bus">
							<div class="box-left">
								<span class="time-added">op tijd</span>
								<i class="iconsprite-pt iconsprite--bus"></i>
								<span class="time-arrival">12:50</span>
							</div>
							<div class="box-right">
								<div>
									<span class="traject-location">Bushalte Dorpsstraat</span>
									<span class="additional-information">Halte 23</span>
								</div>
							</div>
						</div>
					
						<div class="transport" icon="iconsprite--short-tram">
							<div class="box-left">
								<span class="time-added">op tijd</span>
								<i class="iconsprite-pt iconsprite--tram"></i>
								<span class="time-arrival arrival-delay">12:50</span>
							</div>
							<div class="box-right">
								<div>
									<span class="traject-location">Metro Weesperplein</span>
									<span class="additional-information">metrohalte</span>
								</div>
							</div>
						</div>
						<div class="transport" icon="iconsprite--short-subway">
							<div class="box-left">
								<span class="time-added">op tijd</span>
								<i class="iconsprite-pt iconsprite--subway"></i>
								<span class="time-arrival arrival-delay">12:50</span>
							</div>
							<div class="box-right">
								<div>
									<span class="traject-location">Metro Weesperplein</span>
									<span class="additional-information">metrohalte</span>
								</div>
							</div>
						</div>
						<div class="transport" icon="iconsprite--short-train">
							<div class="box-left">
								<span class="time-added">op tijd</span>
								<i class="iconsprite-pt iconsprite--train"></i>
								<span class="time-arrival">12:50</span>
							</div>
							<div class="box-right">
								<div>
									<span class="traject-location">Station Zaandam</span>
									<span class="additional-information">Spoor 7a</span>
								</div>
							</div>
						</div>
					</li>
				</ul>
			</div>
		</div>
	</script>

	<script src="js/jquery-1.10.1.min.js"></script>
	<script src="http://code.jquery.com/ui/1.10.3/jquery-ui.js"></script>
	<script src="js/plaatsnamen.js"></script>
	<script src="js/fastclick.js"></script>
	<script src="js/plaatsnamen_autocomplete.js"></script>
	<script src="js/traject-toevoegen.js"></script>
	<script src="js/jquery.storageapi.js"></script>
	<script src="js/idangerous.swiper-2.1.min.js"></script>
	<script src="js/traject-expand.js"></script>
	<script src="js/destination-switch.js"></script>
	<script src="js/hovers.js"></script>

	<script>

	function currentTimePlus(minutes){
		 var currentTime = new Date().getTime();
		 var minutesToAdd = minutes;

		currentTime += minutesToAdd * 60 * 1000; 

		var newTimeDate = new Date(currentTime);
		return newTimeDate;
	}

	function formatDateAsTime(date){
		var minutes = date.getMinutes();
		var hour = date.getHours();

		if(minutes < 10) minutes = "0" + minutes;
		if(hour < 10) hour = "0" + hour;
		

		return hour + ":" + minutes;
	}

	</script>
	<script>
		var randomTrajecten = ["School", "Werk", "Vriendin", "Bibliotheek", "Universiteit"];
		var mySwiper;
		var storage = $.localStorage;
		var trajecten = storage.get('trajecten');

		if(!trajecten) trajecten = [];

		//storage.removeAll();
		
		$(function(){
			FastClick.attach(document.body);
		
			$('.swiper-container, .swiper-slide').height($(window).height());
			
		    mySwiper = new Swiper('.swiper-container', {
		      loop:false,
		      pagination: '.pagination',
		      paginationClickable: true,
		      cssWidthAndHeight : true,
			
		    });

		    initHovers();
		    
		    console.log(trajecten);

		    for(var i=0; i < trajecten.length; i++){
		    	var traject = trajecten[i];
		    	
		    	var trajectNaam = traject.trajectNaam;
				var van = traject.van;
				var naar = traject.naar;
				var image = traject.image;
				addTrajectSlide(trajectNaam, van, naar, image, i);
		    }
		});

		$('.toevoegen .button-cancel').click(function(){
			hideToevoegen();
		});

		$(".add").click(function(){	
			showToevoegen();
		});

		function addTrajectSlide(trajectNaam, van, naar, image, index){	
			var newSlide = $($('#traject-slide-template').html());
			
			addDummyData(newSlide);
			if(index == undefined) index = trajecten.length;
			
			newSlide.attr('index', index);
	    	newSlide.find('.traject-name').html(trajectNaam);
	    	newSlide.find('.from').html(van);
	    	newSlide.find('.to').html(naar);
	    	newSlide.find('.traject-description').attr('image', image);
	    	newSlide.find('.traject-description').attr("style", "background-image: url(img/trajectbg" + image + ".png)");
	    	newSlide.appendTo('.swiper-wrapper');
			mySwiper.reInit();
	    	
		}

		function editTrajectSlide(slide, trajectNaam, van, naar, image){
	    	slide.find('.traject-name').html(trajectNaam);
	    	slide.find('.from').html(van);
	    	slide.find('.to').html(naar);
	    	slide.find('.traject-description').attr('image', image);
	    	slide.find('.traject-description').attr("style", "background-image: url(img/trajectbg" + image + ".png)");
		}

		function addDummyData($slide){
			$row = $slide.find('li');

			for(var i=0; i < 8; i++){
				$newRow = $row.clone();
				$newRow.insertAfter($row);
			}
			$row = $slide.find('li');

			console.log("dsfjhdsj");
			var minuteSteps = 15;
			var travelTime = 15 + Math.floor(Math.random() * 20);

			var numDelays = 0;
			$row.each(function(index,value){
				
				var timeStart = currentTimePlus(minuteSteps * index);
				var timeEnd = currentTimePlus(minuteSteps * index + travelTime);
				var timeDifference = timeEnd.getTime() - timeStart.getTime();
				


				$(this).find('.time-start').html(formatDateAsTime(timeStart));
				$(this).find('.time-end').html(formatDateAsTime(timeEnd));

				var transports = $(this).find('.transport');

				transports.each(function(i, v){
					if(index%2 ==0){
						if(i == 2){
							$(this).remove();
						}
					}

					
				});

				var timeSteps = timeDifference / transports.size();

				transports.each(function(i, v){
					var dateTimeStamp = timeStart.getTime();
					dateTimeStamp += timeSteps * i;

					var date = new Date(dateTimeStamp);

					$(this).find('.time-arrival').html(formatDateAsTime(date));
				});

				if(index < 4){

					var random = Math.floor(Math.random() * 4);
					var isDelayed = false;
					var vertraging = Math.floor(Math.random() * 10) +1;

					if(random%2 == 0 && numDelays < 2){
						isDelayed = true;

						$(this).find('.time-end').addClass('late');
						$(this).find('.delay-time').html('+ '+ vertraging + ' MIN');
						numDelays++;
					}

					var transports = $(this).find('.transport');

						if(isDelayed){

							//$(this).addClass("delayed");
							var aantalVervoersmiddelen;
							if(vertraging < 5){
								aantalVervoersmiddelen = 1;
							}else{
								aantalVervoersmiddelen = 2;
							}
							var random;
							var prevRandom;

							for(var i=0; i< aantalVervoersmiddelen; i++){

								random = Math.floor(Math.random() * transports.size());	
								if(i == 1){
									while(true){
										if(prevRandom == random){
											random = Math.floor(Math.random() * transports.size());	
										}else{
											break;
										}
									}
								}

								prevRandom = random;


				
								var transport = transports.eq(random)
									transport.addClass("delayed");
								var icon = transport.attr('icon');
								$(this).find("."+ icon).show();
								
								if(aantalVervoersmiddelen == 1){
									transport.find('.time-added').html("+"+vertraging + " MIN");
								}else{
									if(i == 0){
										var randomVertraging = 2 + Math.floor(Math.random() * 3);
										transport.find('.time-added').html("+"+randomVertraging + " MIN");
										vertraging -= randomVertraging;
									}
									if(i == 1){
										transport.find('.time-added').html("+"+vertraging + " MIN");
									}
								}

							}

						}					
					
				}
				
			})

		}

	</script>


	<script src="js/show-traject-details.js"></script>

</body>
</html>